<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Healthy Browsing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/6.7.0/d3.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fafafa;
      margin: 40px;
    }
    .grid-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      margin-top: 20px;
    }
    .chart-container {
      background-color: #fff;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      padding: 10px;
    }
    .chart-container svg {
      width: 100%;
      height: 400px;
    }
    .tooltip {
      position: absolute;
      background-color: rgba(0, 0, 0, 0.75);
      color: #fff;
      padding: 6px 10px;
      border-radius: 4px;
      pointer-events: none;
      font-size: 12px;
    }
    .legend {
      font-size: 12px;
    }
    select {
      font-size: 14px;
      padding: 6px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>Healthy Browsing</h1>
  <p>Your browser history can tell stories about your mental health, from an increase in overall usage, frequency of certain sites, and keywords presented on the site. Explore the visuals below about your internet history.</p>
  
  <div class="grid-container">
    <div class="chart-container">
      <svg id="barChart" width="600" height="400"></svg>
    </div>
    <div class="chart-container">
      <h3>Donut Chart</h3>
      <p>Filter Donut Chart by Day of Week:</p>
      <select id="dayDropdown"></select>
      <svg id="donutChart" width="600" height="400"></svg>
    </div>
    <div class="chart-container">
      <p>Internet Browsing over Time</p>
      <svg id="chart2" width="600" height="400"></svg>
    </div>
    <div class="chart-container">
      <p style="text-align:center; padding-top: 180px; color: #aaa;">Add another chart or summary here.</p>
    </div>
  </div>

  <div class="tooltip" style="opacity: 0;"></div>

  <script>
    const tooltip = d3.select(".tooltip");

    // Bar Chart
    const barSvg = d3.select("#barChart");
    d3.csv("chart1.csv", d3.autoType).then(function(data) {
      const validData = data.filter(d => d.domain && d.domain !== "");
      const domainCounts = d3.rollup(validData, v => v.length, d => d.domain);
      const processedData = Array.from(domainCounts, ([domain, count]) => ({ domain, count }))
        .sort((a, b) => d3.descending(a.count, b.count))
        .slice(0, 10);

      const margin = {top: 40, right: 20, bottom: 60, left: 180},
            width = +barSvg.attr("width") - margin.left - margin.right,
            height = +barSvg.attr("height") - margin.top - margin.bottom;

      const chart = barSvg.append("g")
                       .attr("transform", `translate(${margin.left},${margin.top})`);

      const y = d3.scaleBand()
                  .domain(processedData.map(d => d.domain))
                  .range([0, height])
                  .padding(0.15);

      const x = d3.scaleLinear()
                  .domain([0, d3.max(processedData, d => d.count)])
                  .range([0, width]);

      chart.append("g").attr("transform", `translate(0, ${height})`).call(d3.axisBottom(x));
      chart.append("g").call(d3.axisLeft(y));

      barSvg.append("text")
         .attr("x", +barSvg.attr("width") / 2)
         .attr("y", 25)
         .attr("text-anchor", "middle")
         .attr("font-size", "18px")
         .attr("fill", "#333")
         .text("Top 10 Most Visited Domains");

      chart.selectAll("rect")
           .data(processedData)
           .enter()
           .append("rect")
           .attr("y", d => y(d.domain))
           .attr("x", 0)
           .attr("height", y.bandwidth())
           .attr("width", 0)
           .attr("fill", "#69b3a2")
           .transition()
           .duration(1000)
           .attr("width", d => x(d.count));

      chart.selectAll("rect")
           .on("mouseover", function(event, d) {
              tooltip.transition().duration(200).style("opacity", 1);
              tooltip.html(`<strong>${d.domain}</strong><br>${d.count} visits`)
                     .style("left", (event.pageX + 10) + "px")
                     .style("top", (event.pageY - 28) + "px");
              d3.select(this).attr("fill", "#4c837a");
           })
           .on("mouseout", function() {
              tooltip.transition().duration(300).style("opacity", 0);
              d3.select(this).attr("fill", "#69b3a2");
           });
    });

    // Donut Chart
    const donutSvg = d3.select("#donutChart");
    d3.csv("FinalAggregatedDataset.csv", d3.autoType).then(function(data) {
      const allDays = Array.from(new Set(data.map(d => d["Day of Week"]))).sort();
      const dropdown = d3.select("#dayDropdown");

      donutSvg.append("text")
         .attr("x", +donutSvg.attr("width") / 2)
         .attr("y", 25)
         .attr("text-anchor", "middle")
         .attr("font-size", "18px")
         .attr("fill", "#333")
         .text("Internet Traffic by Keywords");

      dropdown.selectAll("option")
              .data(allDays)
              .enter()
              .append("option")
              .text(d => d)
              .attr("value", d => d);

      drawDonut(data, allDays[0]);

      dropdown.on("change", function() {
        const selectedDay = d3.select(this).property("value");
        drawDonut(data, selectedDay);
      });

      function drawDonut(data, dayFilter) {
        donutSvg.selectAll("*").remove();

        const filtered = data.filter(d => d["Day of Week"] === dayFilter);
        const grouped = d3.rollup(filtered, v => v.length, d => d["Hour (bins)"]);
        const donutData = Array.from(grouped, ([label, value]) => ({ label, value }));

        const width = +donutSvg.attr("width"),
              height = +donutSvg.attr("height"),
              radius = Math.min(width, height) / 2 - 50;

        const chart = donutSvg.append("g")
                              .attr("transform", `translate(${width / 2}, ${height / 2})`);

        const color = d3.scaleOrdinal()
                        .domain(donutData.map(d => d.label))
                        .range(d3.schemeTableau10);

        const pie = d3.pie().value(d => d.value).sort(null);
        const arc = d3.arc().innerRadius(radius * 0.5).outerRadius(radius);

        chart.selectAll("path")
             .data(pie(donutData))
             .enter()
             .append("path")
             .attr("fill", d => color(d.data.label))
             .attr("d", arc)
             .on("mouseover", function(event, d) {
                tooltip.transition().duration(200).style("opacity", 1);
                tooltip.html(`<strong>${d.data.label}</strong><br>${d.data.value} visits`)
                       .style("left", (event.pageX + 10) + "px")
                       .style("top", (event.pageY - 28) + "px");
             })
             .on("mouseout", function() {
                tooltip.transition().duration(300).style("opacity", 0);
             });
      }
    });

    // Line Chart
    const lineSvg = d3.select("#chart2");
    const margin = {top: 10, right: 30, bottom: 30, left: 60},
          width = +lineSvg.attr("width") - margin.left - margin.right,
          height = +lineSvg.attr("height") - margin.top - margin.bottom;

    const chartGroup = lineSvg.append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    d3.csv("chart2.csv", function(d) {
      return {date: d3.timeParse("%m/%d/%Y")(d.date), value: +d.value 
             "All Websites",value:+d.value};
    }).then(function(data) {
      const x = d3.scaleTime()
                  .domain(d3.extent(data, d => d.date))
                  .range([0, width]);

      const y = d3.scaleLinear()
                  .domain([0, d3.max(data, d => d.value)])
                  .range([height, 0]);

      chartGroup.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

      chartGroup.append("g").call(d3.axisLeft(y));

      chartGroup.append("path")
                .datum(data)
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 2)
                .attr("d", d3.line()
                  .x(d => x(d.date))
                  .y(d => y(d.value)));
    });
  </script>
</body>
</html>
