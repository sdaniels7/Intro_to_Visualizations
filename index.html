<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Healthy Browsing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/6.7.0/d3.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fafafa;
      margin: 40px;
    }
    .grid-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      margin-top: 20px;
    }
    .chart-container {
      background-color: #fff;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      padding: 10px;
    }
    .chart-container svg {
      width: 100%;
      height: 400px;
    }
    .tooltip {
      position: absolute;
      background-color: rgba(0, 0, 0, 0.75);
      color: #fff;
      padding: 6px 10px;
      border-radius: 4px;
      pointer-events: none;
      font-size: 12px;
    }
    select {
      font-size: 14px;
      padding: 6px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>Healthy Browsing</h1>
  <p>Your browser history can tell stories about your mental health, from an increase in overall usage, frequency of certain sites, and keywords presented on the site. Explore the visuals below about your internet history.</p>
  
  <div class="grid-container">
    <div class="chart-container">
      <svg id="barChart" width="600" height="400"></svg>
    </div>
    <div class="chart-container">
      <h3>Donut Chart</h3>
      <p>Filter Donut Chart by Day of Week:</p>
      <select id="dayDropdown"></select>
      <svg id="donutChart" width="600" height="400"></svg>
    </div>
    <div class="chart-container">
      <p>Internet Browsing over Time</p>
      <svg id="chart2" width="600" height="400"></svg>
    </div>
    <div class="chart-container">
      <p style="text-align:center; padding-top: 180px; color: #aaa;">Bubble Chart</p>
      <svg id="chart4" width="600" height="400"></svg>
    </div>
  </div>

  <div class="tooltip" style="opacity: 0;"></div>

  <script>
    const tooltip = d3.select(".tooltip");

    // Bar Chart
    const barSvg = d3.select("#barChart");
    d3.csv("chart1.csv", d3.autoType).then(function(data) {
      const validData = data.filter(d => d.domain && d.domain !== "");
      const domainCounts = d3.rollup(validData, v => v.length, d => d.domain);
      const processedData = Array.from(domainCounts, ([domain, count]) => ({ domain, count }))
        .sort((a, b) => d3.descending(a.count, b.count))
        .slice(0, 10);

      const margin = {top: 40, right: 20, bottom: 60, left: 180},
            width = +barSvg.attr("width") - margin.left - margin.right,
            height = +barSvg.attr("height") - margin.top - margin.bottom;

      const chart = barSvg.append("g")
                       .attr("transform", `translate(${margin.left},${margin.top})`);

      const y = d3.scaleBand()
                  .domain(processedData.map(d => d.domain))
                  .range([0, height])
                  .padding(0.15);

      const x = d3.scaleLinear()
                  .domain([0, d3.max(processedData, d => d.count)])
                  .range([0, width]);

      chart.append("g").attr("transform", `translate(0, ${height})`).call(d3.axisBottom(x));
      chart.append("g").call(d3.axisLeft(y));

      barSvg.append("text")
         .attr("x", +barSvg.attr("width") / 2)
         .attr("y", 25)
         .attr("text-anchor", "middle")
         .attr("font-size", "18px")
         .attr("fill", "#333")
         .text("Top 10 Most Visited Domains");

      chart.selectAll("rect")
           .data(processedData)
           .enter()
           .append("rect")
           .attr("y", d => y(d.domain))
           .attr("x", 0)
           .attr("height", y.bandwidth())
           .attr("width", 0)
           .attr("fill", "#69b3a2")
           .transition()
           .duration(1000)
           .attr("width", d => x(d.count));

      chart.selectAll("rect")
           .on("mouseover", function(event, d) {
              tooltip.transition().duration(200).style("opacity", 1);
              tooltip.html(`<strong>${d.domain}</strong><br>${d.count} visits`)
                     .style("left", (event.pageX + 10) + "px")
                     .style("top", (event.pageY - 28) + "px");
              d3.select(this).attr("fill", "#4c837a");
           })
           .on("mouseout", function() {
              tooltip.transition().duration(300).style("opacity", 0);
              d3.select(this).attr("fill", "#69b3a2");
           });
    });

    // RidgeLine Chart(#2)
   
          // set the dimensions and margins of the graph
          var margin = {top: 60, right: 30, bottom: 20, left:110},
              width = 460 - margin.left - margin.right,
              height = 400 - margin.top - margin.bottom;
          
          // append the svg object to the body of the page
          var svg = d3.select("chart2")
            .append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
            .append("g")
              .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");
          
          //read data
          d3.csv("chart2.csv", function(data) {
          
            // Get the different categories and count them
            var categories = data.columns
            var n = categories.length
          
            // Add X axis
            var x = d3.scaleLinear()
              .domain([-10, 140])
              .range([ 0, width ]);
            svg.append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(x));
          
            // Create a Y scale for densities
            var y = d3.scaleLinear()
              .domain([0, 0.4])
              .range([ height, 0]);
          
            // Create the Y axis for names
            var yName = d3.scaleBand()
              .domain(categories)
              .range([0, height])
              .paddingInner(1)
            svg.append("g")
              .call(d3.axisLeft(yName));
          
            // Compute kernel density estimation for each column:
            var kde = kernelDensityEstimator(kernelEpanechnikov(7), x.ticks(40)) // increase this 40 for more accurate density.
            var allDensity = []
            for (i = 0; i < n; i++) {
                key = categories[i]
                density = kde( data.map(function(d){  return d[key]; }) )
                allDensity.push({key: key, density: density})
            }
          
            // Add areas
            svg.selectAll("areas")
              .data(allDensity)
              .enter()
              .append("path")
                .attr("transform", function(d){return("translate(0," + (yName(d.key)-height) +")" )})
                .datum(function(d){return(d.density)})
                .attr("fill", "#69b3a2")
                .attr("stroke", "#000")
                .attr("stroke-width", 1)
                .attr("d",  d3.line()
                    .curve(d3.curveBasis)
                    .x(function(d) { return x(d[0]); })
                    .y(function(d) { return y(d[1]); })
                )
          
          })
          
          // This is what I need to compute kernel density estimation
          function kernelDensityEstimator(kernel, X) {
            return function(V) {
              return X.map(function(x) {
                return [x, d3.mean(V, function(v) { return kernel(x - v); })];
              });
            };
          }
          function kernelEpanechnikov(k) {
            return function(v) {
              return Math.abs(v /= k) <= 1 ? 0.75 * (1 - v * v) / k : 0;
            };
          }

    // Line Chart
    const lineSvg = d3.select("#chart2");
    const margin = {top: 10, right: 30, bottom: 30, left: 60},
          width = +lineSvg.attr("width") - margin.left - margin.right,
          height = +lineSvg.attr("height") - margin.top - margin.bottom;

    const chartGroup = lineSvg.append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    lineSvg.append("text")
         .attr("x", +lineSvg.attr("width") / 2)
         .attr("y", 25)
         .attr("text-anchor", "middle")
         .attr("font-size", "18px")
         .attr("fill", "#333")
         .text("Website Visits Over Time");

    d3.csv("chart2.csv").then(function(rawData) {
      const parseDate = d3.timeParse("%m/%d/%Y");

      // Count website visits per date
      const dateCounts = d3.rollup(
        rawData,
        v => v.length,
        d => parseDate(d.date)
      );

      const data = Array.from(dateCounts, ([date, value]) => ({ date, value }));

      const x = d3.scaleTime()
                  .domain(d3.extent(data, d => d.date))
                  .range([0, width]);

      const y = d3.scaleLinear()
                  .domain([0, d3.max(data, d => d.value)])
                  .range([height, 0]);

      chartGroup.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

      chartGroup.append("g")
                .call(d3.axisLeft(y));

      chartGroup.append("path")
                .datum(data)
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 2)
                .attr("d", d3.line()
                  .x(d => x(d.date))
                  .y(d => y(d.value)));

  //Bubble Chart (Chart2)
      
// set the dimensions and margins of the graph
var margin = {top: 10, right: 20, bottom: 30, left: 50},
    width = 500 - margin.left - margin.right,
    height = 420 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

//Read the data
d3.csv("chart4.csv", function(data) {

  // Add X axis
  var x = d3.scaleLinear()
    .domain([0, 10000])
    .range([ 0, width ]);
  svg.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x));

  // Add Y axis
  var y = d3.scaleLinear()
    .domain([35, 90])
    .range([ height, 0]);
  svg.append("g")
    .call(d3.axisLeft(y));

  // Add a scale for bubble size
  var z = d3.scaleLinear()
    .domain([200000, 1310000000])
    .range([ 1, 40]);

  // Add dots
  svg.append('g')
    .selectAll("dot")
    .data(data)
    .enter()
    .append("circle")
      .attr("cx", function (d) { return x(d.Frequency); } )
      .attr("cy", function (d) { return y(d.); } )
      .attr("r", function (d) { return z(d.Frequency); } )
      .style("fill", "#69b3a2")
      .style("opacity", "0.7")
      .attr("stroke", "black")

})
      
    });
  </script>
</body>
</html>
